<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Event Ticket Booking System</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(#e6f0ff, #ffffff);
            margin: 0;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .toggle-buttons {
            text-align: center;
            margin-bottom: 20px;
        }
        button {
            margin: 0 10px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            background: #4CAF50;
            color: white;
            border-radius: 8px;
        }
        button.logout {
            background-color: #f44336;
        }
        .section {
            display: none;
            max-width: 600px;
            margin: auto;
            padding: 20px;
            border-radius: 10px;
            background-color: #f9f9f9;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        input, select {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            box-sizing: border-box; /* Include padding and border in the element's total width and height */
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        th, td {
            padding: 8px;
            border: 1px solid #ccc;
            text-align: center;
        }
        .visible {
            display: block;
        }
        .message {
            text-align: center;
            color: red;
            margin-top: 10px;
        }
    </style>
</head>
<body>

<h1>Event Ticket Booking</h1>

<div class="toggle-buttons" id="mainToggleButtons">
    </div>

---

<div id="auth" class="section visible">
    <h2>Welcome! Please Login or Register</h2>
    <div class="toggle-buttons">
        <button onclick="showAuthForm('login')">Login</button>
        <button onclick="showAuthForm('register')">Register</button>
    </div>

    <form id="loginForm" class="visible">
        <h3>Login</h3>
        <label>Username:</label>
        <input type="text" id="loginUsername" required>
        <label>Password:</label>
        <input type="password" id="loginPassword" required>
        <button type="submit">Login</button>
        <p id="loginMessage" class="message"></p>
    </form>

    <form id="registerForm" style="display: none;">
        <h3>Register</h3>
        <label>Username:</label>
        <input type="text" id="registerUsername" required>
        <label>Password:</label>
        <input type="password" id="registerPassword" required>
        <label>Role:</label>
        <select id="registerRole" required>
            <option value="user">User</option>
            <option value="admin">Admin</option>
        </select>
        <button type="submit">Register</button>
        <p id="registerMessage" class="message"></p>
    </form>
</div>

---

<div id="user" class="section">
    <h2>User Booking</h2>
    <form id="bookingForm">
        <label>Name:</label>
        <input type="text" id="userName" required>
        
        <label>Email:</label>
        <input type="email" id="userEmail" required>
        
        <label>Event:</label>
        <select id="eventSelect" required>
            <option value="">Select an event</option>
        </select>
        
        <label>Tickets:</label>
        <input type="number" id="ticketCount" min="1" value="1" required>

        <button type="submit">Book Ticket</button>
    </form>
</div>

---

<div id="admin" class="section">
    <h2>Admin Panel</h2>

    <h3>Add New Event</h3>
    <form id="addEventForm">
        <label>Event Name:</label>
        <input type="text" id="eventName" required>
        <button type="submit">Add Event</button>
    </form>

    <h3>All Events</h3>
    <table id="eventListTable">
        <thead>
            <tr>
                <th>Event Name</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="eventList">
            <tr><td colspan="2">No events yet.</td></tr>
        </tbody>
    </table>

    <h3>All Bookings</h3>
    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Event</th>
                <th>Tickets</th>
            </tr>
        </thead>
        <tbody id="bookingList">
            <tr><td colspan="4">No bookings yet.</td></tr>
        </tbody>
    </table>
</div>

<script>
    // DOM Elements
    const authSection = document.getElementById('auth');
    const userSection = document.getElementById('user');
    const adminSection = document.getElementById('admin');
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');
    const loginMessage = document.getElementById('loginMessage');
    const registerMessage = document.getElementById('registerMessage');
    const mainToggleButtons = document.getElementById('mainToggleButtons');

    const bookingForm = document.getElementById('bookingForm');
    const bookingList = document.getElementById('bookingList');
    const eventSelect = document.getElementById('eventSelect');

    const addEventForm = document.getElementById('addEventForm');
    const eventNameInput = document.getElementById('eventName');
    const eventList = document.getElementById('eventList');

    // Data Storage (using localStorage for demonstration)
    // Initialize from localStorage or use empty arrays if not present
    let users = JSON.parse(localStorage.getItem('users')) || [];
    let bookings = JSON.parse(localStorage.getItem('bookings')) || [];
    let events = JSON.parse(localStorage.getItem('events')) || [];

    let currentUser = null; // Stores the currently logged-in user

    // --- Authentication Functions ---

    /**
     * Toggles between the login and registration forms.
     * @param {string} formType - 'login' or 'register'.
     */
    function showAuthForm(formType) {
        loginForm.style.display = 'none';
        registerForm.style.display = 'none';
        if (formType === 'login') {
            loginForm.style.display = 'block';
        } else {
            registerForm.style.display = 'block';
        }
        loginMessage.textContent = ''; // Clear previous messages
        registerMessage.textContent = '';
    }

    // Event listener for login form submission
    loginForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const username = document.getElementById('loginUsername').value;
        const password = document.getElementById('loginPassword').value;

        // Find user by username and password
        const user = users.find(u => u.username === username && u.password === password);

        if (user) {
            currentUser = user; // Set the current logged-in user
            localStorage.setItem('currentUser', JSON.stringify(currentUser)); // Store in localStorage
            loginMessage.textContent = '';
            alert('Login successful!');
            renderApp(); // Re-render the application based on login status
        } else {
            loginMessage.textContent = 'Invalid username or password.';
        }
    });

    // Event listener for registration form submission
    registerForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const username = document.getElementById('registerUsername').value;
        const password = document.getElementById('registerPassword').value;
        const role = document.getElementById('registerRole').value;

        // Check if username already exists
        if (users.some(u => u.username === username)) {
            registerMessage.textContent = 'Username already exists.';
            return;
        }

        // Add new user
        users.push({ username, password, role });
        localStorage.setItem('users', JSON.stringify(users)); // Save updated users to localStorage
        registerMessage.textContent = 'Registration successful! You can now log in.';
        showAuthForm('login'); // Redirect to login form
    });

    /**
     * Logs out the current user.
     */
    function logout() {
        currentUser = null;
        localStorage.removeItem('currentUser'); // Remove current user from localStorage
        alert('Logged out successfully!');
        renderApp(); // Re-render the application to show authentication view
    }

    // --- Event Management Functions (Admin) ---

    // Event listener for adding new events
    addEventForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const eventName = eventNameInput.value.trim();
        if (eventName) {
            events.push({ name: eventName });
            localStorage.setItem('events', JSON.stringify(events)); // Save event
            eventNameInput.value = ''; // Clear input
            renderEvents(); // Update event list in admin view
            populateEventSelect(); // Update event dropdown for users
        }
    });

    /**
     * Renders the list of events in the admin panel.
     */
    function renderEvents() {
        if (events.length === 0) {
            eventList.innerHTML = '<tr><td colspan="2">No events yet.</td></tr>';
            return;
        }

        eventList.innerHTML = ''; // Clear existing list
        events.forEach((event, index) => {
            const row = `<tr>
                <td>${event.name}</td>
                <td><button onclick="deleteEvent(${index})">Delete</button></td>
            </tr>`;
            eventList.innerHTML += row;
        });
    }

    /**
     * Deletes an event from the list.
     * @param {number} index - The index of the event to delete.
     */
    function deleteEvent(index) {
        if (confirm('Are you sure you want to delete this event?')) {
            events.splice(index, 1); // Remove event from array
            localStorage.setItem('events', JSON.stringify(events)); // Save updated events
            renderEvents(); // Re-render event list
            populateEventSelect(); // Update event dropdown
        }
    }

    /**
     * Populates the event selection dropdown for user bookings.
     */
    function populateEventSelect() {
        eventSelect.innerHTML = '<option value="">Select an event</option>'; // Default option
        events.forEach(event => {
            const option = document.createElement('option');
            option.value = event.name;
            option.textContent = event.name;
            eventSelect.appendChild(option);
        });
    }

    // --- User Booking Functions ---

    // Event listener for booking form submission
    bookingForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const name = document.getElementById('userName').value;
        const email = document.getElementById('userEmail').value;
        const event = document.getElementById('eventSelect').value;
        const tickets = document.getElementById('ticketCount').value;

        if (!event) {
            alert("Please select an event.");
            return;
        }

        bookings.push({ name, email, event, tickets }); // Add new booking
        localStorage.setItem('bookings', JSON.stringify(bookings)); // Save booking
        bookingForm.reset(); // Clear form
        alert("Booking successful!");
        renderBookings(); // Update admin view if visible
    });

    /**
     * Renders the list of all bookings in the admin panel.
     */
    function renderBookings() {
        if (bookings.length === 0) {
            bookingList.innerHTML = '<tr><td colspan="4">No bookings yet.</td></tr>';
            return;
        }

        bookingList.innerHTML = ''; // Clear existing list
        bookings.forEach(b => {
            const row = `<tr>
                <td>${b.name}</td>
                <td>${b.email}</td>
                <td>${b.event}</td>
                <td>${b.tickets}</td>
            </tr>`;
            bookingList.innerHTML += row;
        });
    }

    // --- Main Application Rendering Logic ---

    /**
     * Shows a specific section of the application.
     * @param {string} view - 'auth', 'user', or 'admin'.
     */
    function showSection(view) {
        // Hide all sections first
        authSection.classList.remove('visible');
        userSection.classList.remove('visible');
        adminSection.classList.remove('visible');

        // Show the requested section and perform specific actions
        if (view === 'user') {
            userSection.classList.add('visible');
            populateEventSelect(); // Ensure event dropdown is updated
        } else if (view === 'admin') {
            adminSection.classList.add('visible');
            renderEvents(); // Render events when admin view is shown
            renderBookings(); // Render bookings when admin view is shown
        } else { // 'auth'
            authSection.classList.add('visible');
            showAuthForm('login'); // Default to login form
        }
    }

    /**
     * Renders the main application view based on login status and user role.
     */
    function renderApp() {
        // Clear previous toggle buttons
        mainToggleButtons.innerHTML = '';

        // Get current user from localStorage
        currentUser = JSON.parse(localStorage.getItem('currentUser'));

        if (currentUser) {
            // If logged in, add logout button
            const logoutBtn = document.createElement('button');
            logoutBtn.textContent = `Logout (${currentUser.username})`;
            logoutBtn.classList.add('logout');
            logoutBtn.onclick = logout;
            mainToggleButtons.appendChild(logoutBtn);

            // Add role-specific view buttons
            if (currentUser.role === 'user') {
                const userViewBtn = document.createElement('button');
                userViewBtn.textContent = 'User View';
                userViewBtn.onclick = () => showSection('user');
                mainToggleButtons.appendChild(userViewBtn);
                showSection('user'); // Show user view by default
            } else if (currentUser.role === 'admin') {
                const adminViewBtn = document.createElement('button');
                adminViewBtn.textContent = 'Admin View';
                adminViewBtn.onclick = () => showSection('admin');
                mainToggleButtons.appendChild(adminViewBtn);
                showSection('admin'); // Show admin view by default
            }
        } else {
            // If not logged in, show authentication section
            showSection('auth');
        }
    }

    // Initial render when the page loads
    renderApp();
</script>

</body>
</html>